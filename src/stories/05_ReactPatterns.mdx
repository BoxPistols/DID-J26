{/* ReactPatterns.mdx */}
import { Meta } from '@storybook/blocks'

<Meta title="Learning/05_Reactパターン" />

# Reactパターン

本プロジェクトで使用される高度な React パターン。

## 1. useCallback フック

関数をメモ化してパフォーマンスを最適化します。

```typescript
import { useCallback } from 'react'

const MapController = ({ onAddLayer }) => {
  const handleAddLayer = useCallback((layer) => {
    setLayers(prev => [...prev, layer])
  }, [])

  return <LayerManager onAddLayer={handleAddLayer} />
}
```

## 2. useMemo フック

計算コストの高い処理をメモ化します。

```typescript
import { useMemo } from 'react'

const AirportMap = ({ airports, selectedRegion }) => {
  const filteredAirports = useMemo(() => {
    return airports.filter(airport => airport.region === selectedRegion)
  }, [airports, selectedRegion])

  return <Map airports={filteredAirports} />
}
```

## 3. useRef フック

DOM アクセスや値を保持します。

```typescript
import { useRef } from 'react'

const MapContainer = () => {
  const mapRef = useRef(null)
  const tilesCacheRef = useRef(new Map())

  return <div ref={mapRef} style={{ width: '100%', height: '100vh' }} />
}
```

## 4. useReducer フック

複雑な状態ロジックを管理します。

```typescript
import { useReducer } from 'react'

type FlightPlanState = {
  waypoints: Array<[number, number]>
  isValid: boolean
}

function flightPlanReducer(state, action) {
  switch (action.type) {
    case 'ADD_WAYPOINT':
      return { ...state, waypoints: [...state.waypoints, action.coord] }
    case 'RESET':
      return { waypoints: [], isValid: false }
    default:
      return state
  }
}
```

## 5. React.memo

不要な再レンダリングを防止します。

```typescript
import { memo } from 'react'

const LayerItem = memo(({ layer, isSelected }) => {
  return (
    <div style={{ backgroundColor: isSelected ? '#e0e0e0' : 'transparent' }}>
      {layer.name}
    </div>
  )
})
```

## 6. Error Boundaries

エラーハンドリングします。

```typescript
import { Component } from 'react'

class ErrorBoundary extends Component {
  state = { hasError: false }

  static getDerivedStateFromError(error) {
    return { hasError: true }
  }

  render() {
    if (this.state.hasError) {
      return <div>エラーが発生しました</div>
    }
    return this.props.children
  }
}
```

## 7. Context API

データを共有します。

```typescript
import { createContext, useContext, useState } from 'react'

const MapContext = createContext(undefined)

export const MapProvider = ({ children }) => {
  const [center, setCenter] = useState([137.0, 36.5])
  return (
    <MapContext.Provider value={{ center, setCenter }}>
      {children}
    </MapContext.Provider>
  )
}

export const useMapContext = () => {
  return useContext(MapContext)
}
```

