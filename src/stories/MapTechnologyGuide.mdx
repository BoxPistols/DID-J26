{/* MapTechnologyGuide.mdx */}
import { Meta } from '@storybook/blocks'

<Meta title="Learning/Map Technology Guide" />

# 地図技術学習ガイド

MapLibre GLを使った地図開発の基礎から応用まで

---

## 第1章：地図の基本概念

### 1.1 デジタル地図とは？

紙の地図と違い、デジタル地図は複数のレイヤーを重ね合わせて構成されています。

```
地図ビュー
  ↑
┌─────────────────────────┐
│ インタラクション層       │ (クリック、ホバー)
├─────────────────────────┤
│ UI レイヤー             │ (アイコン、ラベル)
├─────────────────────────┤
│ ビジネス層              │ (制限区域、施設)
├─────────────────────────┤
│ ベースマップ層          │ (道路、建物)
├─────────────────────────┤
│ タイルシステム          │ (WebMercator投影)
└─────────────────────────┘
```

### 1.2 MapLibre GL とは？

WebGLを使った高速な地図レンダリングエンジン。以下の特徴：

- **ベクタータイル対応**：小さいサイズで高品質な地図
- **リアルタイム更新**：動的にレイヤーを追加・削除
- **複雑なスタイリング**：条件付きスタイル、3D表現
- **オープンソース**：カスタマイズ可能

### 1.3 座標系の理解

地図上の位置を表現するための座標系：

```typescript
// 緯度・経度（WGS84）
const tokyoStation = {
  latitude: 35.6812,   // 南北の位置（-90 ~ 90）
  longitude: 139.7673  // 東西の位置（-180 ~ 180）
}

// MapLibreでは [longitude, latitude] の順
const coordinates: [number, number] = [139.7673, 35.6812]

// ズームレベル
// 0-28 の値で地図の拡大率を表す
// 0: 世界全体
// 5: 日本全体
// 10: 都道府県レベル
// 15: 市区町村レベル
// 20: 街路レベル
```

---

## 第2章：GeoJSONデータフォーマット

### 2.1 GeoJSON とは？

地理的な位置情報とその属性データを表現するJSON形式。

**基本構造**

```typescript
interface GeoJSON {
  type: 'FeatureCollection' | 'Feature' | 'Geometry'
  features?: Feature[]
}

interface Feature {
  type: 'Feature'
  geometry: Geometry
  properties: Record<string, any>
}

type Geometry = Point | LineString | Polygon | MultiPolygon
```

### 2.2 Point（点）

単一の地点を表現（例：空港、施設）

```typescript
const airport: GeoJSON.Feature = {
  type: 'Feature',
  geometry: {
    type: 'Point',
    coordinates: [140.3929, 35.7719] // [経度, 緯度]
  },
  properties: {
    name: '成田国際空港',
    type: 'international',
    elevation: 10
  }
}
```

**視覚化例**
```
地図上に点で表示
  ◆ 成田空港
```

### 2.3 LineString（線）

複数の点を結んだ線（例：飛行経路、境界線）

```typescript
const flightRoute: GeoJSON.Feature = {
  type: 'Feature',
  geometry: {
    type: 'LineString',
    coordinates: [
      [139.7673, 35.6812],  // 出発地（東京）
      [139.7000, 35.6700],  // 途中地点
      [140.3929, 35.7719]   // 到着地（成田）
    ]
  },
  properties: {
    name: 'フライト1',
    distance: 57.6
  }
}
```

**視覚化例**
```
地図上に線で表示
  ◆—◆—◆
  出発  途中  到着
```

### 2.4 Polygon（多角形）

閉じた領域を表現（例：禁止区域、施設の敷地）

```typescript
const restrictionZone: GeoJSON.Feature = {
  type: 'Feature',
  geometry: {
    type: 'Polygon',
    coordinates: [[
      [139.6, 35.6],   // 1点目
      [139.8, 35.6],   // 2点目
      [139.8, 35.8],   // 3点目
      [139.6, 35.8],   // 4点目
      [139.6, 35.6]    // 1点目（閉じる）
    ]]
  },
  properties: {
    name: '飛行禁止区域',
    type: 'no_fly_red'
  }
}
```

**重要**：最初の点と最後の点は同じ座標（閉じられた図形）

**視覚化例**
```
地図上に塗りつぶされた矩形で表示
  ┌─────┐
  │禁止 │
  │区域 │
  └─────┘
```

### 2.5 FeatureCollection（複数のフィーチャー）

複数のフィーチャーをまとめたもの（最もよく使う）

```typescript
const noFlyZones: GeoJSON.FeatureCollection = {
  type: 'FeatureCollection',
  features: [
    {
      type: 'Feature',
      geometry: {
        type: 'Polygon',
        coordinates: [[
          [139.6, 35.6], [139.8, 35.6],
          [139.8, 35.8], [139.6, 35.8],
          [139.6, 35.6]
        ]]
      },
      properties: { name: '赤ゾーン', type: 'red' }
    },
    {
      type: 'Feature',
      geometry: {
        type: 'Polygon',
        coordinates: [[
          [139.5, 35.5], [139.9, 35.5],
          [139.9, 35.9], [139.5, 35.9],
          [139.5, 35.5]
        ]]
      },
      properties: { name: '黄ゾーン', type: 'yellow' }
    }
  ]
}
```

### 2.6 GeoJSON の作成パターン

**パターン1：静的なデータ**

```typescript
const staticZones = {
  type: 'FeatureCollection',
  features: [...]
}

map.addSource('zones', { type: 'geojson', data: staticZones })
```

**パターン2：APIから取得**

```typescript
async function loadZonesFromAPI() {
  const response = await fetch('/api/no-fly-zones')
  const geojson = await response.json()
  
  if (map.getSource('zones')) {
    (map.getSource('zones') as maplibregl.GeoJSONSource).setData(geojson)
  } else {
    map.addSource('zones', { type: 'geojson', data: geojson })
  }
}
```

**パターン3：動的に更新**

```typescript
function updateZones(newFeatures: GeoJSON.Feature[]) {
  const updatedGeoJSON = {
    type: 'FeatureCollection' as const,
    features: newFeatures
  }
  
  const source = map.getSource('zones') as maplibregl.GeoJSONSource
  source.setData(updatedGeoJSON)
}
```

---

## 第3章：MapLibre GL の基本操作

### 3.1 地図の初期化

```typescript
import maplibregl from 'maplibre-gl'

const map = new maplibregl.Map({
  container: 'map',              // DOM要素のID
  style: 'https://...',          // スタイルURL（次章で詳しく）
  center: [139, 36.5],           // 中心座標 [経度, 緯度]
  zoom: 5,                       // ズームレベル
  pitch: 0,                      // 傾き（0-60度）
  bearing: 0                     // 回転（0-360度）
})

// 地図の読み込み完了を待つ
map.on('load', () => {
  console.log('地図が準備完了')
  // この時点でレイヤーを追加可能
})
```

### 3.2 ズームの操作

```typescript
// ズームレベルを設定
map.setZoom(10)

// ズームレベルを取得
const zoom = map.getZoom()

// 段階的にズーム
map.zoomIn()   // 1段階拡大
map.zoomOut()  // 1段階縮小

// 特定の領域に自動フィット
const bounds = [
  [139.6, 35.6],   // [西, 南]
  [139.8, 35.8]    // [東, 北]
]
map.fitBounds(bounds, { padding: 50 })
```

### 3.3 中心と回転

```typescript
// 中心座標を移動
map.setCenter([140, 36])

// スムーズに移動
map.flyTo({
  center: [140, 36],
  zoom: 10,
  duration: 2000  // 2秒で移動
})

// 回転
map.setBearing(45)  // 45度回転

// 傾け（3D表現）
map.setPitch(30)    // 30度傾ける
```

### 3.4 ソース（データ源）の追加

```typescript
// GeoJSON ソースを追加
map.addSource('airports', {
  type: 'geojson',
  data: airportsGeoJSON
})

// ラスター（画像）ソースを追加
map.addSource('satellite', {
  type: 'raster',
  url: 'https://...',
  tileSize: 256
})

// ベクタータイルソースを追加
map.addSource('osm', {
  type: 'vector',
  url: 'https://...'
})

// ソースを取得
const source = map.getSource('airports')

// ソースを削除
map.removeSource('airports')
```

---

## 第4章：レイヤーとスタイリング

### 4.1 レイヤーとは？

ソース内のデータを、地図上にどう表現するかを定義します。

```
データ（Source）
    ↓
  レイヤー（Layer）
    ↓
視覚化（地図上に表示）
```

### 4.2 基本的なレイヤー

```typescript
// 1. Fill レイヤー（塗りつぶし）
map.addLayer({
  id: 'no-fly-zones-fill',
  type: 'fill',
  source: 'zones',
  paint: {
    'fill-color': '#FF0000',
    'fill-opacity': 0.3
  }
})

// 2. Line レイヤー（線）
map.addLayer({
  id: 'routes-line',
  type: 'line',
  source: 'routes',
  paint: {
    'line-color': '#0000FF',
    'line-width': 2
  }
})

// 3. Circle レイヤー（円）
map.addLayer({
  id: 'airports-circle',
  type: 'circle',
  source: 'airports',
  paint: {
    'circle-radius': 6,
    'circle-color': '#00AA00'
  }
})

// 4. Symbol レイヤー（アイコン・テキスト）
map.addLayer({
  id: 'airports-label',
  type: 'symbol',
  source: 'airports',
  layout: {
    'text-field': ['get', 'name'],
    'text-size': 12,
    'text-offset': [0, 1.5]
  }
})
```

### 4.3 Filter（フィルタリング）

特定の条件のデータのみを表示：

```typescript
// type が 'red' のデータのみ表示
map.addLayer({
  id: 'red-zones',
  type: 'fill',
  source: 'zones',
  filter: ['==', ['get', 'type'], 'red'],
  paint: {
    'fill-color': '#FF0000',
    'fill-opacity': 0.3
  }
})

// elevation が 1000以上のみ表示
map.addLayer({
  id: 'high-airports',
  type: 'circle',
  source: 'airports',
  filter: ['>=', ['get', 'elevation'], 1000],
  paint: {
    'circle-radius': 8,
    'circle-color': '#FF0000'
  }
})

// 複数条件（AND）
map.setFilter('airports-circle', [
  'all',
  ['==', ['get', 'type'], 'international'],
  ['>=', ['get', 'elevation'], 500]
])

// 複数条件（OR）
map.setFilter('airports-circle', [
  'any',
  ['==', ['get', 'name'], '成田'],
  ['==', ['get', 'name'], '羽田']
])
```

### 4.4 Paint プロパティ（色・スタイル）

```typescript
const paintProps = {
  // Fill レイヤー
  'fill-color': '#FF0000',           // 塗りつぶし色
  'fill-opacity': 0.5,               // 透明度（0-1）
  'fill-outline-color': '#000000',   // 枠線色

  // Line レイヤー
  'line-color': '#0000FF',           // 線の色
  'line-width': 2,                   // 線の幅
  'line-opacity': 0.8,               // 線の透明度
  'line-dasharray': [5, 5],          // 破線パターン

  // Circle レイヤー
  'circle-radius': 6,                // 円の半径
  'circle-color': '#00AA00',         // 円の色
  'circle-opacity': 0.8,             // 円の透明度
  'circle-stroke-color': '#000000',  // 枠線色
  'circle-stroke-width': 1           // 枠線の幅
}
```

### 4.5 Layout プロパティ（表示・非表示、サイズ）

```typescript
const layoutProps = {
  // 全レイヤー共通
  'visibility': 'visible' | 'none',  // 表示/非表示

  // Symbol レイヤー
  'text-field': ['get', 'name'],     // 表示するテキスト（プロパティから取得）
  'text-size': 12,                   // テキストサイズ
  'text-offset': [0, 1.5],           // テキストのオフセット
  'text-anchor': 'top',              // テキストの基準点
  'icon-image': 'airport-icon',      // アイコン画像
  'icon-size': 1.0,                  // アイコンサイズ
  'icon-opacity': 0.8                // アイコン透明度
}
```

### 4.6 Expressions（条件付きスタイリング）

データの値に応じて動的にスタイルを変更：

```typescript
// elevation に応じて色を変更
map.addLayer({
  id: 'airports-by-elevation',
  type: 'circle',
  source: 'airports',
  paint: {
    'circle-radius': 6,
    'circle-color': [
      'interpolate',
      ['linear'],
      ['get', 'elevation'],
      0,    '#00FF00',    // 標高0m: 緑
      500,  '#FFFF00',    // 標高500m: 黄
      1000, '#FF0000'     // 標高1000m以上: 赤
    ]
  }
})

// type に応じて色を変更（分岐）
map.addLayer({
  id: 'zones-by-type',
  type: 'fill',
  source: 'zones',
  paint: {
    'fill-color': [
      'match',
      ['get', 'type'],
      'red',    '#FF0000',
      'yellow', '#FFFF00',
      'blue',   '#0000FF',
      '#CCCCCC'  // デフォルト色
    ],
    'fill-opacity': 0.3
  }
})
```

---

## 第5章：インタラクション

### 5.1 クリックイベント

```typescript
map.on('click', 'airports-circle', (e) => {
  const feature = e.features[0]
  console.log('クリック:', feature.properties.name)
  
  // ポップアップを表示
  new maplibregl.Popup()
    .setLngLat(e.lngLat)
    .setHTML(`<h3>${feature.properties.name}</h3>`)
    .addTo(map)
})

// クリック可能な領域を視覚的に示す
map.on('mouseenter', 'airports-circle', () => {
  map.getCanvas().style.cursor = 'pointer'
})

map.on('mouseleave', 'airports-circle', () => {
  map.getCanvas().style.cursor = ''
})
```

### 5.2 ホバーイベント

```typescript
// マウスが乗ったら色が変わる
map.on('mouseenter', 'zones', (e) => {
  map.setFeatureState(
    { source: 'zones', id: e.features[0].id },
    { hovered: true }
  )
})

map.on('mouseleave', 'zones', (e) => {
  map.setFeatureState(
    { source: 'zones', id: e.features[0].id },
    { hovered: false }
  )
})

// paint プロパティで状態に応じた色を設定
map.setPaintProperty('zones', 'fill-opacity', [
  'case',
  ['boolean', ['feature-state', 'hovered'], false],
  0.8,  // ホバー時：不透明
  0.3   // 通常：半透明
])
```

### 5.3 地図をクリック

```typescript
// 地図上の任意の点をクリック
map.on('click', (e) => {
  console.log('座標:', e.lngLat)
  
  // クリック地点にマーカーを追加
  new maplibregl.Marker()
    .setLngLat(e.lngLat)
    .setPopup(new maplibregl.Popup().setHTML('クリック地点'))
    .addTo(map)
})
```

### 5.4 マーカーとポップアップ

```typescript
// 単純なマーカー
const marker = new maplibregl.Marker()
  .setLngLat([139.7673, 35.6812])
  .addTo(map)

// カスタムアイコン付きマーカー
const customMarker = new maplibregl.Marker({
  color: '#FF0000',
  scale: 0.8
})
  .setLngLat([140.3929, 35.7719])
  .setPopup(
    new maplibregl.Popup()
      .setHTML('<h3>成田空港</h3><p>世界一の空港</p>')
  )
  .addTo(map)

// マーカーを削除
marker.remove()
```

---

## 第6章：このプロジェクトでの実装パターン

### 6.1 禁止区域の表示（赤ゾーン・黄ゾーン）

```typescript
// src/App.tsx の実装パターン

import maplibregl from 'maplibre-gl'
import { useEffect, useRef, useState } from 'react'
import { NoFlyZoneService } from '@/lib/services/noFlyZones'

function MapWithNoFlyZones() {
  const mapContainer = useRef<HTMLDivElement>(null)
  const map = useRef<maplibregl.Map | null>(null)
  const [isMapReady, setIsMapReady] = useState(false)
  const [showRedZones, setShowRedZones] = useState(true)
  const [showYellowZones, setShowYellowZones] = useState(true)

  // Map の初期化
  useEffect(() => {
    if (!mapContainer.current) return

    map.current = new maplibregl.Map({
      container: mapContainer.current,
      style: 'https://cyberjapandata.gsi.go.jp/xyz/std/style.json',
      center: [137, 36.5],
      zoom: 5
    })

    map.current.on('load', () => setIsMapReady(true))

    return () => map.current?.remove()
  }, [])

  // No-Fly Zone レイヤーを追加
  useEffect(() => {
    if (!isMapReady || !map.current) return

    // GeoJSON を取得
    async function loadZones() {
      const zones = await NoFlyZoneService.getAll()
      const geoJson = NoFlyZoneService.toGeoJSON()

      // ソースを追加
      map.current!.addSource('no-fly-zones', {
        type: 'geojson',
        data: geoJson
      })

      // Red Zone レイヤー
      map.current!.addLayer({
        id: 'red-zones',
        type: 'fill',
        source: 'no-fly-zones',
        filter: ['==', ['get', 'type'], 'red'],
        paint: {
          'fill-color': '#FF0000',
          'fill-opacity': ['case', 
            ['boolean', ['feature-state', 'hovered'], false],
            0.5,  // ホバー時
            0.3   // 通常
          ]
        }
      })

      // Yellow Zone レイヤー
      map.current!.addLayer({
        id: 'yellow-zones',
        type: 'fill',
        source: 'no-fly-zones',
        filter: ['==', ['get', 'type'], 'yellow'],
        paint: {
          'fill-color': '#FFFF00',
          'fill-opacity': 0.2
        }
      })
    }

    loadZones()
  }, [isMapReady])

  // 表示/非表示の切り替え
  useEffect(() => {
    if (!isMapReady || !map.current) return

    map.current.setLayoutProperty(
      'red-zones',
      'visibility',
      showRedZones ? 'visible' : 'none'
    )
  }, [showRedZones, isMapReady])

  useEffect(() => {
    if (!isMapReady || !map.current) return

    map.current.setLayoutProperty(
      'yellow-zones',
      'visibility',
      showYellowZones ? 'visible' : 'none'
    )
  }, [showYellowZones, isMapReady])

  return (
    <div>
      <div>
        <label>
          <input
            type="checkbox"
            checked={showRedZones}
            onChange={(e) => setShowRedZones(e.target.checked)}
          />
          Red Zones を表示
        </label>
        <label>
          <input
            type="checkbox"
            checked={showYellowZones}
            onChange={(e) => setShowYellowZones(e.target.checked)}
          />
          Yellow Zones を表示
        </label>
      </div>
      
      <div 
        ref={mapContainer} 
        style={{ width: '100%', height: '600px' }}
      />
    </div>
  )
}
```

### 6.2 動的なレイヤー追加・削除

```typescript
// ユーザー操作に応じてレイヤーを追加・削除

function addRestrictionLayer(type: string, color: string) {
  if (!map.current) return

  const layerId = `restriction-${type}`
  
  // 既に存在する場合はスキップ
  if (map.current.getLayer(layerId)) return

  map.current.addLayer({
    id: layerId,
    type: 'fill',
    source: 'restrictions',
    filter: ['==', ['get', 'type'], type],
    paint: {
      'fill-color': color,
      'fill-opacity': 0.3
    }
  })
}

function removeRestrictionLayer(type: string) {
  if (!map.current) return

  const layerId = `restriction-${type}`
  if (map.current.getLayer(layerId)) {
    map.current.removeLayer(layerId)
  }
}

// UI から呼び出し
function ControlPanel() {
  return (
    <button onClick={() => addRestrictionLayer('airport', '#90EE90')}>
      空港区域を追加
    </button>
  )
}
```

### 6.3 クリックで詳細情報を表示

```typescript
// レイヤーをクリックして詳細を表示

function setupLayerClickHandler() {
  if (!map.current) return

  map.current.on('click', 'red-zones', (e) => {
    const feature = e.features?.[0]
    if (!feature) return

    const { name, type, description } = feature.properties

    new maplibregl.Popup({ closeButton: true })
      .setLngLat(e.lngLat)
      .setHTML(`
        <div style="font-size: 14px;">
          <h3>${name}</h3>
          <p><strong>タイプ:</strong> ${type}</p>
          <p><strong>説明:</strong> ${description}</p>
        </div>
      `)
      .addTo(map.current)
  })

  // マウスカーソルの変更
  map.current.on('mouseenter', 'red-zones', () => {
    map.current!.getCanvas().style.cursor = 'pointer'
  })

  map.current.on('mouseleave', 'red-zones', () => {
    map.current!.getCanvas().style.cursor = ''
  })
}
```

---

## 第7章：パフォーマンス最適化

### 7.1 大規模データセットの処理

```typescript
// ❌ 非効率：全データを1つのレイヤーで表示
map.addSource('all-zones', { type: 'geojson', data: allZonesGeoJSON })
map.addLayer({ id: 'all-zones-layer', type: 'fill', source: 'all-zones' })

// ✅ 効率的：ズームレベルで表示を切り替え
function setupZoomBasedLayers() {
  // ズームレベル 5以上: 赤ゾーンのみ表示
  // ズームレベル 10以上: 赤・黄ゾーン表示
  // ズームレベル 15以上: すべて表示

  map.on('zoom', () => {
    const zoom = map.getZoom()

    if (zoom < 5) {
      map.setLayoutProperty('red-zones', 'visibility', 'none')
      map.setLayoutProperty('yellow-zones', 'visibility', 'none')
    } else if (zoom < 10) {
      map.setLayoutProperty('red-zones', 'visibility', 'visible')
      map.setLayoutProperty('yellow-zones', 'visibility', 'none')
    } else {
      map.setLayoutProperty('red-zones', 'visibility', 'visible')
      map.setLayoutProperty('yellow-zones', 'visibility', 'visible')
    }
  })
}
```

### 7.2 データの段階的な読み込み

```typescript
// ❌ 非効率：全データを一度に読み込み
async function loadAllDataAtOnce() {
  const allData = await fetch('/api/all-zones').then(r => r.json())
  map.getSource('zones').setData(allData) // 重い処理
}

// ✅ 効率的：表示範囲に応じて読み込み
async function loadDataByBounds() {
  const bounds = map.getBounds()
  
  const response = await fetch(
    `/api/zones?bbox=${bounds.getWest()},${bounds.getSouth()},${bounds.getEast()},${bounds.getNorth()}`
  )
  
  const data = await response.json()
  map.getSource('zones').setData(data)
}

// 地図移動時に呼び出し
map.on('moveend', loadDataByBounds)
```

### 7.3 レイヤーキャッシング

```typescript
// レイヤー設定をキャッシュして再利用

const layerCache = new Map<string, maplibregl.LayerSpecification>()

function addLayerWithCache(layerId: string, layerSpec: maplibregl.LayerSpecification) {
  if (!layerCache.has(layerId)) {
    layerCache.set(layerId, layerSpec)
  }

  const spec = layerCache.get(layerId)!
  
  if (!map.getLayer(layerId)) {
    map.addLayer(spec)
  }
}

// 使用
addLayerWithCache('red-zones', {
  id: 'red-zones',
  type: 'fill',
  source: 'zones',
  filter: ['==', ['get', 'type'], 'red'],
  paint: { 'fill-color': '#FF0000', 'fill-opacity': 0.3 }
})
```

---

## 第8章：トラブルシューティング

### 8.1 よくあるエラーと対処法

**エラー1：レイヤーが表示されない**

```typescript
// ❌ よくある原因1：ソースが追加されていない
map.addLayer({
  id: 'my-layer',
  type: 'fill',
  source: 'non-existent',  // このソースが存在しない
  paint: { 'fill-color': '#FF0000' }
})

// ✅ 対処：まずソースを確認
if (!map.getSource('my-source')) {
  map.addSource('my-source', { type: 'geojson', data: myGeoJSON })
}

// ❌ よくある原因2：フィルタで全件除外されている
map.addLayer({
  id: 'my-layer',
  type: 'fill',
  source: 'my-source',
  filter: ['==', ['get', 'type'], 'nonexistent-type'],  // データにない型
  paint: { 'fill-color': '#FF0000' }
})

// ✅ 対処：フィルタを確認
console.log(map.getFilter('my-layer'))
```

**エラー2：インタラクションが機能しない**

```typescript
// ❌ よくある原因：レイヤーIDが間違っている
map.on('click', 'layer-id-typo', (e) => {
  console.log('クリック')  // これは実行されない
})

// ✅ 対処：レイヤーが存在するか確認
if (map.getLayer('red-zones')) {
  map.on('click', 'red-zones', (e) => {
    console.log('クリック成功')
  })
}
```

### 8.2 デバッグのコツ

```typescript
// 1. 現在のレイヤー一覧を確認
const layers = map.getStyle().layers
console.log('レイヤー一覧:', layers.map(l => l.id))

// 2. 特定のレイヤーの設定を確認
const layerSpec = map.getLayer('red-zones')
console.log('レイヤー設定:', layerSpec)

// 3. ソースデータを確認
const source = map.getSource('zones') as maplibregl.GeoJSONSource
const data = source.getClusterLeaves(0, 1000)
console.log('データ:', data)

// 4. 地図上の座標を確認
map.on('click', (e) => {
  console.log(`クリック座標: [${e.lngLat.lng}, ${e.lngLat.lat}]`)
})
```

---

## 参考リソース

### 公式ドキュメント
- [MapLibre GL JS](https://maplibre.org/maplibre-gl-js/)
- [GeoJSON 仕様](https://geojson.org/)
- [Style Specification](https://maplibre.org/maplibre-gl-js/style-spec/)

### 便利なツール
- [GeoJSON Editor](https://geojson.io/) - GeoJSONの作成・編集
- [MapLibre GL Style Playground](https://maplibre.org/maplibre-gl-js-docs/example/) - スタイルの試験
- [Overpass Turbo](https://overpass-turbo.osm.de/) - OpenStreetMap データ取得

---

## まとめ

### 習得すべき順序

1. **基本概念の理解**：座標系、GeoJSON
2. **初期化と操作**：地図の作成、ズーム・移動
3. **レイヤーの理解**：ソース → レイヤー → 表示
4. **スタイリング**：paint、layout、filter、expression
5. **インタラクション**：クリック、ホバー
6. **パフォーマンス最適化**：大規模データ対応

### 次のステップ

- **カスタムスタイルの作成**：Maputnik を使って独自のスタイルを作成
- **WebGL 表現**：3D モデルの表示、高度な表現
- **リアルタイム更新**：WebSocket を使った動的データ更新
- **地図解析**：turf.js との組み合わせで複雑な地理計算
