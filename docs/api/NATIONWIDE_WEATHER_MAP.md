# å…¨å›½å¤©æ°—ãƒãƒƒãƒ—

TVå¤©æ°—äºˆå ±ã‚¹ã‚¿ã‚¤ãƒ«ã§å…¨å›½ã®å¤©æ°—ã‚’ä¸€è¦§è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ã€‚

## æ¦‚è¦

å…¨47éƒ½é“åºœçœŒ + åœ°åŸŸåŒºåˆ†ï¼ˆåŒ—æµ·é“4åœ°åŸŸã€æ²–ç¸„3åœ°åŸŸï¼‰ã®è¨ˆ53åœ°ç‚¹ã®å¤©æ°—æƒ…å ±ã‚’åœ°å›³ä¸Šã«ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¡¨ç¤ºã—ã¾ã™ã€‚

## æ©Ÿèƒ½

- **å¤©æ°—ã‚«ãƒ¼ãƒ‰**: å„éƒ½å¸‚ã®å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³ã€æ°—æ¸©ã€éƒ½å¸‚åã‚’è¡¨ç¤º
- **è©³ç´°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—**: ã‚¯ãƒªãƒƒã‚¯ã§é¢¨é€Ÿã€æ¹¿åº¦ã€é™æ°´é‡ã‚’è¡¨ç¤º
- **ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ UI**: åŠé€æ˜ãƒ‡ã‚¶ã‚¤ãƒ³ã§èƒŒæ™¯åœ°å›³ã‚‚è¦–èªå¯èƒ½
- **ESCã‚­ãƒ¼å¯¾å¿œ**: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§é–‰ã˜ã‚‹
- **ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œ**: ãƒ†ãƒ¼ãƒã«åˆã‚ã›ãŸé…è‰²åˆ‡ã‚Šæ›¿ãˆ
- **é€²æ—è¡¨ç¤º**: ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã¯é€²æ—ç‡ï¼ˆ0-100%ï¼‰ã‚’è¡¨ç¤º

## å¯¾å¿œåœ°ç‚¹

### åŒ—æµ·é“ï¼ˆ5åœ°ç‚¹ï¼‰

| ID | éƒ½å¸‚å | åœ°åŸŸ | ç·¯åº¦ | çµŒåº¦ |
|----|-------|------|------|------|
| hokkaido-central | æœ­å¹Œ | é“å¤® | 43.06 | 141.35 |
| hokkaido-north | ç¨šå†… | é“åŒ— | 45.42 | 141.67 |
| hokkaido-east | é‡§è·¯ | é“æ± | 42.98 | 144.38 |
| hokkaido-south | å‡½é¤¨ | é“å— | 41.77 | 140.73 |
| hokkaido-asahikawa | æ—­å· | é“åŒ— | 43.77 | 142.37 |

### æ²–ç¸„ï¼ˆ3åœ°ç‚¹ï¼‰

| ID | éƒ½å¸‚å | åœ°åŸŸ | ç·¯åº¦ | çµŒåº¦ |
|----|-------|------|------|------|
| okinawa-naha | é‚£è¦‡ | æ²–ç¸„æœ¬å³¶ | 26.21 | 127.68 |
| okinawa-miyako | å®®å¤å³¶ | å…ˆå³¶ | 24.80 | 125.28 |
| okinawa-ishigaki | çŸ³å£å³¶ | å…ˆå³¶ | 24.34 | 124.16 |

### ãã®ä»–45éƒ½åºœçœŒ

å„éƒ½åºœçœŒã®çœŒåºæ‰€åœ¨åœ°ï¼ˆä»£è¡¨éƒ½å¸‚ï¼‰1åœ°ç‚¹ãšã¤ã€‚

## API

### Props

```typescript
interface NationwideWeatherMapProps {
  map: maplibregl.Map           // MapLibre GLã®åœ°å›³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
  visible: boolean              // è¡¨ç¤º/éè¡¨ç¤º
  darkMode?: boolean            // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: falseï¼‰
  onLoadingChange?: (           // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
    isLoading: boolean,
    progress?: number           // é€²æ—ç‡ï¼ˆ0-100ï¼‰
  ) => void
}
```

### ä½¿ç”¨ä¾‹

```tsx
import { NationwideWeatherMap } from './components/weather/NationwideWeatherMap'

function App() {
  const [showWeather, setShowWeather] = useState(false)
  const [loadingLayers, setLoadingLayers] = useState(new Map())

  return (
    <>
      <Map ref={mapRef} />

      {mapRef.current && (
        <NationwideWeatherMap
          map={mapRef.current}
          visible={showWeather}
          darkMode={darkMode}
          onLoadingChange={(loading, progress) => {
            setLoadingLayers(prev => {
              const next = new Map(prev)
              if (loading) {
                next.set('weather', { name: 'å¤©æ°—', progress })
              } else {
                next.delete('weather')
              }
              return next
            })
          }}
        />
      )}
    </>
  )
}
```

## UIä»•æ§˜

### å¤©æ°—ã‚«ãƒ¼ãƒ‰ï¼ˆãƒãƒ¼ã‚«ãƒ¼ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  éƒ½å¸‚å  â”‚
â”‚   â˜€ï¸    â”‚  â† å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆSVGï¼‰
â”‚   15Â°   â”‚  â† æ°—æ¸©
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **èƒŒæ™¯**: ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ï¼ˆåŠé€æ˜ + backdrop-filter: blurï¼‰
  - ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰: `rgba(30, 41, 59, 0.8)`
  - ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰: `rgba(255, 255, 255, 0.88)`
- **è§’ä¸¸**: 10px
- **å½±**: `box-shadow: 0 4px 12px rgba(0,0,0,0.12~0.3)`

### è©³ç´°ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”
â”‚ æœ­å¹Œ              [é“å¤®]   â”‚ âœ• â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”¤
â”‚  â˜€ï¸  15Â°C                     â”‚
â”‚      æ™´ã‚Œ                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ’¨      ğŸ’§      ğŸŒ§ï¸          â”‚
â”‚ é¢¨é€Ÿ    æ¹¿åº¦    é™æ°´é‡        â”‚
â”‚ 3.2m/s  45%    0.0mm         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **èƒŒæ™¯**: ã‚°ãƒ©ã‚¹ãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ 
  - ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰: `rgba(30, 41, 59, 0.92)`
  - ãƒ©ã‚¤ãƒˆãƒ¢ãƒ¼ãƒ‰: `rgba(255, 255, 255, 0.97)`
- **è§’ä¸¸**: 16px
- **é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³**: Flexboxã§ä¸­å¤®é…ç½®ã€outline: none
- **ESCã‚­ãƒ¼**: ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹

## å¤©æ°—ã‚¢ã‚¤ã‚³ãƒ³

SVGãƒ™ãƒ¼ã‚¹ã®ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ã‚¢ã‚¤ã‚³ãƒ³ï¼š

| ã‚¿ã‚¤ãƒ— | ã‚¢ã‚¤ã‚³ãƒ³ | å¤©æ°—ã‚³ãƒ¼ãƒ‰ |
|-------|---------|-----------|
| sunny | â˜€ï¸ | 0, 1 |
| partly_cloudy | ğŸŒ¤ï¸ | 2, 3 |
| cloudy | â˜ï¸ | 45, 48 |
| rainy | ğŸŒ§ï¸ | 51-67, 80-82 |
| snowy | â„ï¸ | 71-77, 85, 86 |
| stormy | â›ˆï¸ | 95-99 |

## ãƒ‡ãƒ¼ã‚¿å–å¾—

### ãƒãƒƒãƒå‡¦ç†

53åœ°ç‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’10ä»¶ãšã¤ãƒãƒƒãƒã§å–å¾—ã—ã€é€²æ—ç‡ã‚’é€šçŸ¥ï¼š

```typescript
const batchSize = 10
for (let i = 0; i < WEATHER_LOCATIONS.length; i += batchSize) {
  const batch = WEATHER_LOCATIONS.slice(i, i + batchSize)
  await Promise.allSettled(batch.map(city => fetchWeather(city.lat, city.lng)))

  completed += batch.length
  const progress = Math.round((completed / total) * 100)
  onLoadingChange?.(true, progress)
}
```

### ã‚­ãƒ£ãƒƒã‚·ãƒ¥

- å¤©æ°—ãƒ‡ãƒ¼ã‚¿ã¯ `fetchedRef` ã§ãƒ•ãƒ©ã‚°ç®¡ç†
- åŒä¸€ã‚»ãƒƒã‚·ãƒ§ãƒ³å†…ã§ã¯å†å–å¾—ã—ãªã„

## ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- **ãƒãƒ¼ã‚«ãƒ¼ç®¡ç†**: MapLibre GL Marker ã‚’ä½¿ç”¨
- **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: `visible=false` æ™‚ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’å‰Šé™¤
- **ãƒ¡ãƒ¢ãƒª**: useRef ã§ DOM å‚ç…§ã‚’ç®¡ç†ã€ä¸è¦æ™‚ã«è§£æ”¾

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«

- `src/components/weather/NationwideWeatherMap.tsx` - ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- `src/lib/services/weatherApi.ts` - å¤©æ°—APIå‘¼ã³å‡ºã—
- `src/App.tsx` - çµ±åˆãƒ»è¡¨ç¤ºåˆ¶å¾¡
